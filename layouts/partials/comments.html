<div id="giscus-comments"></div>
<script src="https://giscus.app/client.js"
        data-repo="DevEstacion/heyron"
        data-repo-id="R_kgDOQsC06g"
        data-category="Comments"
        data-category-id="DIC_kwDOQsC06s4C0DSl"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="{{ .Site.BaseURL }}css/giscus-light.css"
        data-lang="en"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>
<script>
  // Dynamically switch Giscus theme based on Dream theme's dark mode
  document.addEventListener('alpine:initialized', () => {
    Alpine.effect(() => {
      const isDark = Alpine.store('darkMode').isDark();
      const theme = isDark
        ? '{{ .Site.BaseURL }}css/giscus-dark.css'
        : '{{ .Site.BaseURL }}css/giscus-light.css';

      // Wait for iframe with retry logic (max 5 seconds)
      let attempts = 0;
      const maxAttempts = 50; // 50 attempts * 100ms = 5 seconds
      const checkIframe = setInterval(() => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (iframe) {
          clearInterval(checkIframe);
          iframe.contentWindow.postMessage(
            { giscus: { setConfig: { theme } } },
            'https://giscus.app'
          );
        } else if (++attempts >= maxAttempts) {
          clearInterval(checkIframe);
          console.warn('Giscus iframe not found after 5 seconds');
        }
      }, 100);
    });
  });
</script>
